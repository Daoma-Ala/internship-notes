Codificaci√≥n, segmentaci√≥n y exclusiones voluntarias

Twilio selects the appropriate encoding¬†**automatically**¬†based on the¬†**content**¬†of your message

# Codificaci√≥n y Segmentaci√≥n

Ahora hablemos sobre las diferentes codificaciones de caracteres y c√≥mo se segmentan los mensajes SMS.

## Codificaciones de caracteres SMS

Cuando se env√≠a un SMS, se puede utilizar una de dos codificaciones de caracteres:

### GSM-7

La codificaci√≥n GSM-7 contiene las letras y s√≠mbolos m√°s com√∫nmente utilizados del alfabeto latino.

- Utiliza 7 bits por car√°cter.

**Ejemplo:** Caracteres GSM-7: "4/8" -> 1/2

### UCS-2

UCS-2 es una codificaci√≥n similar a Unicode que se utiliza como una opci√≥n de respaldo en redes GSM cuando un mensaje no puede ser codificado utilizando GSM-7.

- Utiliza 16 bits por car√°cter.

**Ejemplo:** ·π¥·∏à·π§¬Ø¬≤ ·∏à·∏£·∫•·πü·∫£·∏â·π≠·ªÉ·πù·πß·ç• „Äù4√∑8„Äû‚Üí ¬Ω
## Twilio selecciona la codificaci√≥n adecuada autom√°ticamente seg√∫n el contenido de tu mensaje. 

Si todos los caracteres del mensaje pueden ser codificados en GSM-7, esa codificaci√≥n ser√° utilizada como la opci√≥n preferida, ya que requiere menos espacio para codificar cada car√°cter. Sin embargo, si el mensaje contiene incluso un solo car√°cter que no puede ser codificado usando GSM-7, se utilizar√° la codificaci√≥n UCS-2.

Dado que cada SMS puede llevar hasta 140 bytes de contenido, un mensaje codificado en GSM-7 (con 7 bits por car√°cter) puede llevar hasta 160 caracteres.

Por otro lado, un solo mensaje UCS-2 (con 16 bits por car√°cter) solo puede llevar hasta 70 caracteres.

Esto nos lleva a los mensajes concatenados y la segmentaci√≥n.

Las API de Twilio permiten enviar y recibir mensajes concatenados que contengan hasta 1600 caracteres. Dichos mensajes aparecer√°n en los registros de Twilio como un √∫nico mensaje con un SID de mensaje.
### Segmentaci√≥n de salida

Las APIs de Twilio dividir√°n autom√°ticamente los mensajes que superen el l√≠mite de caracteres de un solo mensaje en varios segmentos y los enviar√°n como m√∫ltiples mensajes SMS con instrucciones sobre c√≥mo volver a ensamblarlos en el mensaje original. Esto es compatible con la mayor√≠a de los operadores, que pasar√°n esta informaci√≥n de reensamblaje al dispositivo de destino, el cual mostrar√° los segmentos como un solo mensaje largo. Sin embargo, no todos los operadores son compatibles con esto, y los usuarios de esos operadores recibir√°n mensajes largos como segmentos de mensajes cortos individuales. Adem√°s, el orden de los segmentos individuales puede no siempre ser preservado.

### Segmentaci√≥n de entrada

De manera similar, los mensajes segmentados entrantes recibidos por tu n√∫mero de Twilio ser√°n reensamblados por Twilio y entregados a tu aplicaci√≥n como un solo mensaje largo.

### Segmentaci√≥n y codificaci√≥n de caracteres

Durante el proceso de dividir el mensaje concatenado en segmentos individuales, se debe agregar una **metainformaci√≥n especial con instrucciones de reensamblaje (llamado UDH, User Data Header) a cada segmento.**

Esto consume 6 bytes de los 140 bytes que puede llevar cada SMS, lo que reduce a√∫n m√°s el n√∫mero m√°ximo de caracteres en cada segmento del mensaje concatenado:

- Los segmentos de mensaje codificados en GSM-7 pueden llevar hasta 153 caracteres.
- Los segmentos de mensaje codificados en UCS-2 pueden llevar hasta 67 caracteres.


===video===

The following example demonstrates sending a segmented UCS-2 message using¬†[twilio-cli](https://www.twilio.com/docs/twilio-cli/quickstart)
```shell
$ twilio api:core:messages:create --to +19166190659 --from +19166190712 \
         --body 'This is a test of a segmented message using UCS-2 character encoding üëç'
SID                                 From          To            Status  Direction     Date Sent
SM251c17420b0e459eba18a8aff0af96e8  +19166190712  +19166190659  queued  outbound-api  null     

$ twilio api:core:messages:fetch --sid SM251c17420b0e459eba18a8aff0af96e8 --properties status,numSegments
Status     Num Segments
delivered  2     
```
![[Pasted image 20250130104346.png]]

## Notar c√≥mo Twilio segment√≥ autom√°ticamente el cuerpo del mensaje sin que el usuario tuviera que hacer nada especial. 

Tambi√©n ten en cuenta que la tarifa de SMS de Twilio es por segmento, por lo que en los ejemplos anteriores, el usuario ser√° cobrado por dos segmentos.

### Gesti√≥n de exclusi√≥n - **Opt-Out Management**

Los reguladores de todo el mundo se esfuerzan por evitar que sus clientes reciban mensajes no deseados. Los n√∫meros de tel√©fono de c√≥digo largo de Twilio admiten palabras clave de exclusi√≥n de forma predeterminada. Si un cliente responde con STOP a cualquiera de tus mensajes, su n√∫mero de tel√©fono ser√° autom√°ticamente colocado en una lista negra y cualquier intento posterior de enviarle un mensaje ser√° rechazado con el error [21610](http://www.twilio.com/docs/api/errors/21610).

Los clientes pueden eliminarse de la lista negra utilizando las palabras clave START o UNSTOP.

Tambi√©n pueden solicitar m√°s informaci√≥n enviando HELP a tu n√∫mero de tel√©fono, lo que les responder√° con informaci√≥n sobre c√≥mo usar las palabras clave de exclusi√≥n.

Para obtener una lista completa de palabras clave y su comportamiento, consulta este [art√≠culo de soporte.](http://support.twilio.com/hc/en-us/articles/223134027-Twilio-support-for-opt-out-keywords-SMS-STOP-filtering-)


Este mecanismo de exclusi√≥n se puede personalizar a trav√©s de Copilot (que se discutir√° en una secci√≥n posterior) agregando tus propias palabras clave para cada una de las 3 acciones (Exclusi√≥n, Inclusi√≥n y Ayuda) y modificando la respuesta predeterminada que recibe el remitente para cada acci√≥n.

Este mecanismo de exclusi√≥n predeterminado no se aplica a los C√≥digos Cortos. Los usuarios de C√≥digos Cortos deber√°n implementar [su propio mecanismo de exclusi√≥n](http://support.twilio.com/hc/en-us/articles/223182208-Industry-standards-for-U-S-short-code-HELP-and-STOP) o utilizar la funci√≥n Avanzada de Exclusi√≥n de Copilot que discutiremos m√°s adelante.

