# Creación de Tareas desde Llamadas Telefónicas con `<Enqueue>`

Las tareas (Tasks) pueden crearse automáticamente a partir de llamadas telefónicas utilizando el verbo TwiML `<Enqueue>`.

Antes de concluir el curso, veremos brevemente los eventos y el uso de `<Enqueue>` en TaskRouter, y luego repasaremos algunos conceptos clave.

## Eventos

TaskRouter registra **Eventos** para cada cambio de estado en el Workspace con el propósito de generar informes históricos y auditorías. TaskRouter también realizará una solicitud HTTP que contiene los detalles del evento a la **EventCallbackURL** del Workspace cada vez que ocurra uno de estos eventos.

Los eventos se pueden utilizar como entradas para informes en tiempo real y para producir estadísticas sobre el rendimiento de tu centro de contacto.

---

## Creación de Tareas desde Llamadas Telefónicas con `<Enqueue>`

Como se mencionó con los filtros de Workflow, TaskRouter puede manejar automáticamente la escalación y priorización de tareas. Las tareas también pueden crearse automáticamente a partir de llamadas telefónicas utilizando el verbo TwiML `<Enqueue>`.

El verbo `<Enqueue>`, por defecto, simplemente coloca al cliente en una cola de espera. Opcionalmente, también puede crear una tarea asociada al mismo tiempo.

Cuando se encola una llamada:

- El cliente escuchará música de espera en bucle hasta que algún trabajador (Worker) emita una instrucción de `dequeue`, `call` o `conference`.
- Luego, el cliente será sacado de la cola de llamadas y el trabajador será conectado a la llamada del cliente.

---

### Ejemplo de Flujo de Llamada

1. Un cliente llama a un número de teléfono de Twilio.
2. Twilio accede a la URL del webhook de voz del número de teléfono. Esto podría, por ejemplo, implementar un IVR utilizando el verbo `<Gather>` para recopilar la entrada del usuario.
3. El cliente utiliza ese IVR para seleccionar algún departamento.
4. Se crea una nueva tarea mediante el verbo `<Enqueue>`, y el cliente ingresa a una cola de llamadas.
5. La tarea es inspeccionada y evaluada por el Workflow.
6. El Workflow asigna la tarea a una TaskQueue.
7. La TaskQueue identifica al trabajador más adecuado.
8. Se accede a la URL de callback de asignación y devuelve, por ejemplo, una instrucción de `conference`.
9. Se realiza la llamada saliente al `contact_uri` del trabajador y el agente se agrega a una nueva conferencia.
10. El cliente es sacado de la cola de espera y se une a la conferencia con el agente.

---

## Construcción de una Interfaz de Usuario para Agentes

Por último, veamos brevemente cómo construir una interfaz de usuario para tus agentes que implemente algunos de los conceptos discutidos anteriormente, como permitir que los trabajadores acepten reservas.

### Enfoque 1: URL de Callback de Asignación

La primera opción es utilizar la [**URL de Callback de Asignación**](https://www.twilio.com/docs/taskrouter/handle-assignment-callbacks). Esto se hace para notificar a tu aplicación que se ha creado una reserva y que tu aplicación responda con instrucciones que indiquen si la reserva fue aceptada o rechazada, y si se debe realizar alguna orquestación de llamadas adicional.

- Este enfoque requiere pasar webhooks entre Twilio y tu backend. Aunque puede ser más fácil de implementar, será un poco más lento que la siguiente opción, ya que tanto la interfaz de usuario como el backend deben estar involucrados.
- Es ideal para casos de uso en los que los trabajadores no tienen una interfaz de usuario, como recibir tareas como llamadas telefónicas directas.

### Enfoque 2: SDK de TaskRouter.js

La segunda opción utiliza el [**SDK de TaskRouter.js**](https://www.twilio.com/docs/taskrouter/js-sdk/workspace/worker#reservation-actions) directamente en tu frontend. Esto abre una conexión WebSocket persistente directamente a los servidores de Twilio y permite que tu interfaz de usuario se suscriba al evento `reservation.created` y responda directamente sin necesidad de involucrar tu backend.

---

## Conclusión

Has llegado al final del curso de TaskRouter. Esperamos que ahora tengas una mejor comprensión de cómo funciona TaskRouter y cómo diseñar un centro de contacto utilizando esta herramienta.