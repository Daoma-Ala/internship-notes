##  Mostrando datos en la UI de Flex

Ahora tomaremos los datos almacenados en los atributos de la Tarea y los mostraremos a nuestros agentes en la interfaz de usuario de Flex.

O en otras palabras...

![[Pasted image 20250210201905.png]]
Para lograr esto, usaremos la función [**UI Templating**](https://www.twilio.com/docs/flex/ui/localization-and-templating) de Flex, que facilita la personalización de los textos y etiquetas de la interfaz de usuario. Cada cadena de texto en la UI de Flex está definida en el objeto **strings**.

Para imprimir tu objeto `strings` actual, prueba ejecutar el siguiente comando en la consola de tu navegador:

**Twilio.Flex.Manager.getInstance().strings;**

![[Pasted image 20250210202002.png]]

Las cadenas relevantes que controlan el texto mostrado en la lista de tareas son:

- **`TaskHeaderLine`** → Se muestra en la lista de tareas en la primera línea de cada tarea.
- **`TaskLineCallReserved`** → Describe una llamada entrante en el **Call Canvas**, **Task Canvas** y la lista de tareas.
- **`TaskLineSmsReserved`** → Describe un chat entrante por SMS en el **Task Canvas** y la lista de tareas.
- **`TaskLineChatReserved`** → Describe un chat entrante en el **Task Canvas** y la lista de tareas.

![[Pasted image 20250210202115.png]]

Por ejemplo, si quisieras cambiar las cadenas para llamadas, SMS y chats para que coincidan con el ejemplo anterior, podrías hacer algo así:

```javascript
async init(flex, manager) {
  /*
  ...
  */
  manager.strings.TaskHeaderLine = 'Task 1st line';
  manager.strings.TaskLineCallReserved = 'Call 2nd line';
  manager.strings.TaskLineSmsReserved = 'SMS 2nd line';
  manager.strings.TaskLineChatReserved = 'Chat 2nd line';
}
```

---

### **Uso de plantillas en Flex**

Establecer cadenas de texto estáticas es útil, por ejemplo, para localización o para adaptar la UI al contexto de tu centro de contacto, pero tiene sus limitaciones.

Aquí es donde entran las **plantillas**.

Flex utiliza **Handlebars** con la sintaxis de bigotes (`{{variable}}`) para sus plantillas.

Las cadenas de texto con plantillas permiten acceder dinámicamente al contexto de la tarea actual, logrando algo como el ejemplo de la derecha.

#### **¿Cómo se accede al contexto de la tarea?**

Simplemente usa la sintaxis de bigotes `{{variable}}` dentro de la cadena de texto.

![[Pasted image 20250210202236.png]]

Los detalles de la tarea se acceden mediante un objeto llamado `task`, y los atributos de la tarea se encuentran en `task.attributes`.

En nuestro IVR, almacenamos el perfil completo del cliente en el atributo **account_data** dentro de `task.attributes`.

Por lo tanto, si quisiéramos acceder al nombre del cliente, usaríamos:  
`{{task.attributes.account_data.first_name}}`.

Para lograr el ejemplo anterior, agrega lo siguiente a tu **Flex plugin**:

```javascript
async init(flex, manager) {

  /* ... */

  manager.strings.TaskHeaderLine =
    '{{task.attributes.account_data.first_name}} ' + 
    '{{task.attributes.account_data.last_name}}';

  manager.strings.TaskLineCallReserved =
    'SLA: {{task.attributes.account_data.service_level}}';
}
```

Pruébalo ahora y verifica si el nombre del cliente y el SLA aparecen en la interfaz de usuario de Flex cuando llamas.

---

### **Depuración de atributos en TaskRouter**

Este ejercicio depende de que tu IVR, construido en la lección anterior, funcione correctamente y almacene los atributos de la tarea de forma adecuada.

Si algo no funciona, aquí hay formas de solucionar problemas:

1. **Verificar atributos en TaskRouter:**
    
    - Realiza una llamada entrante a tu centro de contacto.
    - Abre la **Consola de Twilio** y ve a la sección **TaskRouter**.
    - Abre tu **Workspace** y selecciona **Tasks**.
    - Busca la tarea de voz recién creada, ábrela e inspecciona sus atributos.
2. **Verificar registros en Studio Flow:**
    
    - Abre el **Studio Flow** de tu IVR.
    - Selecciona la pestaña **Logs**.
    - Abre la ejecución correspondiente a tu última llamada.
    - Expande el registro **PullAccountData**.
    - Haz clic en **Widget & Flow Properties** y busca `widgets.PullAccountData`.
    - ¿Existe una clave llamada **parsed**? ¿Contiene datos devueltos por el CRM?

---

Las tareas de voz contienen de forma predeterminada atributos de llamada adicionales relacionados con la llamada, por ejemplo, from_city, que representa la ciudad asociada con el número de teléfono de la persona que llama.

Si quisiera mostrar la ciudad desde la que llama cada cliente en la lista de tareas, ¿qué valor establecería en la cadena manager.strings.TaskLineCallReserved?

  
**'Calling from {{task.attributes.from_city}}'**
