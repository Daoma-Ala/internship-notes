### Autenticación y Autorización en Flex  

En Flex, tendrás varios usuarios del sistema, como agentes y supervisores, que necesitarán iniciar sesión y autenticarse. Esto se maneja a través de un sistema de terceros de tu elección (un Proveedor de Identidad externo) que actuará como la fuente de verdad. Esto se realiza mediante **Single Sign-On (SSO)** y **SAML**, como se describe a continuación. Esto significa que integrarás Flex con tu sistema y, según sea necesario, gestionarás los usuarios desde ese sistema. Los administradores gestionarán y configurarán a los usuarios desde ese sistema.  

---

### ¿Cómo funciona?  

**SSO (Single Sign-On)** es el proceso de provisionar y autenticar el acceso de los usuarios a un sistema determinado. Hay tres partes principales en cualquier integración de SSO:  

- **Proveedor de Servicios (Service Provider)**: la entidad a la que deseas acceder. Por ejemplo, Twilio Flex.  
- **Proveedor de Identidad (Identity Provider)**: el proveedor de SSO, como Azure, Google Authentication, Okta, entre otros.  
- **SAML (Security Assertion Markup Language)**: un estándar abierto para iniciar sesión de usuarios en aplicaciones.  

**Ejemplo de flujo de inicio de sesión único (SSO) con Flex, un Proveedor de Identidad (IdP) y SAML.**  

===video===
![[Pasted image 20250205110205.png]]

---

### Atributos de Identidad y Roles en Flex  

- Tu **Proveedor de Identidad (IdP)** puede proporcionar cualquier número de afirmaciones (pares clave-valor) a Flex.  
- Todo lo que se pasa desde el IdP se almacena en los atributos del Trabajador (Worker) de TaskRouter.  

---

### ¿Cómo gestiona Flex las identidades?  

1. **Inicio de sesión de usuarios**: Los usuarios que inician sesión en Flex a través de un IdP se convierten automáticamente en usuarios de Flex.  
2. **Auto-provisión de Trabajadores**: Flex provisiona automáticamente un Trabajador (Worker) de TaskRouter para esta identidad.  
3. **Actualización de atributos**: Cada vez que un usuario inicia sesión en Flex, todos los atributos pasados se verifican y actualizan si es necesario (utilizando el IdP como fuente de verdad).  

---

### Atributos de Identidad Obligatorios  

Aunque tu IdP puede proporcionar muchos más datos, ciertos datos son obligatorios. Los tres atributos requeridos para la autenticación y autorización son:  

- **full_name**  
- **email**  
- **roles**  

---

### Roles  

Los nombres completos y los correos electrónicos son autoexplicativos, pero los **roles** definen las capacidades de los usuarios en Flex. Los 3 roles predeterminados admitidos son:  

- **Agente**: Puede ver y participar en las comunicaciones con los clientes.  
- **Supervisor**: Además de las capacidades del agente, puede ver los datos de comunicación de los agentes.  
- **Administrador (Admin)**: Puede mantener y modificar el sistema.  

| **Rol**       | **Descripción**                                                                                   |
|---------------|---------------------------------------------------------------------------------------------------|
| **admin**     | Acceso a todas las páginas de la interfaz de usuario. Puede usar el Admin de Flex, el Escritorio del Agente, Equipos, Estadísticas de Colas, Panel de Control, Análisis, Cuestionarios (funciones de Flex Insights) y el Marcador de Flex (si está habilitado). |
| **supervisor**| Acceso al Escritorio del Agente, Equipos, Estadísticas de Colas y el Marcador de Flex (si está habilitado). |
| **agent**     | Acceso al Escritorio del Agente y al Marcador de Flex (si está habilitado).                       |

---
1. **Proveedor de Identidad (IdP)**:
    
    - Es el proveedor de **Single Sign-On (SSO)**, como Azure, Google Authentication, Okta, entre otros.
        
    - Actúa como la fuente de verdad para la autenticación de usuarios y proporciona los datos necesarios para acceder a Flex.
        
2. **SAML (Security Assertion Markup Language)**:
    
    - Es un estándar abierto de autenticación.
        
    - El **Proveedor de Identidad (IdP)** pasa un **token SAML** al **Proveedor de Servicios (Service Provider)** para iniciar sesión, transmitiendo los datos relacionados según sea necesario.
        
3. **Proveedor de Servicios (Service Provider)**:
    
    - Es la entidad en línea a la que deseas acceder. En este caso, **Twilio Flex**.
        
    - Flex recibe el token SAML del IdP y autentica al usuario basándose en la información proporcionada.
### Resumen  

Has aprendido cómo funcionan la autenticación y la autorización en Flex. Repasemos los componentes clave:  

4. **SSO y SAML**: Integración con un Proveedor de Identidad (IdP) para gestionar usuarios.  
5. **Atributos obligatorios**: `full_name`, `email` y `roles`.  
6. **Roles**: Agente, Supervisor y Administrador, cada uno con capacidades específicas en Flex.  

Este enfoque permite una gestión de usuarios segura y escalable, integrada con tus sistemas existentes.