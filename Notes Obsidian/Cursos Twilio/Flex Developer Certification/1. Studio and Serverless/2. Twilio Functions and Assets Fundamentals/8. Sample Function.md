Imagina que estamos construyendo una interfaz de usuario (UI) frontal que saludará a los usuarios con un chiste después de que inicien sesión. Nos gustaría obtener esos chistes de la API de Joke. Sin embargo, hay un problema: nuestra UI necesita recibir tanto el chiste como la remate (punchline) en un cuerpo de texto plano, sin nada más en el cuerpo de la respuesta.

Si intentamos usar la API directamente, obtenemos un objeto JSON:

```bash
curl "https://v2.jokeapi.dev/joke/Programming?type=twopart&safe-mode"
```

```json
{
    "error": false,
    "category": "Programming",
    "type": "twopart",
    "setup": "Why do programmers wear glasses?",
    "delivery": "Because they need to C#",
    "flags": {
        "nsfw": false,
        "religious": false,
        "political": false,
        "racist": false,
        "sexist": false,
        "explicit": false
    },
    "id": 50,
    "safe": true,
    "lang": "en"
}
```

Lo que necesitamos obtener es algo como esto en su lugar:

```
Why do programmers wear glasses?
Because they need to C#
```

Ahora, eso suena como un caso de uso perfecto para una Función.

---

Comencemos incluyendo un módulo de NPM llamado `request` en las dependencias de nuestras Funciones. Usaremos este módulo para hacer una solicitud HTTP a la API Oficial de Chistes (Official Joke API).

La versión del módulo es opcional y se puede dejar en blanco.

![[Pasted image 20250204185405.png]]

Luego, creemos una nueva Función en blanco y asignémosle un Nombre y una Ruta.

![[Pasted image 20250204185419.png]]

Como último paso, necesitamos proporcionar el código de la Función. Aquí tienes un ejemplo de cómo podría verse dicho código (siéntete libre de copiar y pegar el siguiente código en tu Función):

```javascript
const request = require('request');
exports.handler = function (context, event, callback) {
  let response = new Twilio.Response();
  request(
    'https://v2.jokeapi.dev/joke/Programming?type=twopart&safe-mode',
    (err, res, body) => {
      const joke = JSON.parse(body);
      console.log(joke);
      response.setBody(joke.setup + '\n' + joke.delivery);
      return callback(null, response);
  });
};
```


Ahora revisemos las partes individuales del código:

```javascript
const request = require('request');
```

Aquí estamos cargando el módulo `request`. 

Es mejor hacer esto antes de la definición de la función por motivos de rendimiento, ya que el contenedor se reutiliza entre invocaciones y, por lo tanto, de esta manera el módulo se cargará solo una vez.

Si cargáramos el módulo desde dentro de la función, causaría que el módulo se cargue en cada invocación de nuestra Función.

```javascript
let response = new Twilio.Response();
```

Luego, construimos una respuesta vacía que posteriormente llenaremos con datos de la API y devolveremos como parámetro de la función de callback.

```javascript
request(
  'https://v2.jokeapi.dev/joke/Programming?type=twopart&safe-mode',
  (err, res, body) => {
    const joke = JSON.parse(body);
    console.log(joke);
    response.setBody(joke.setup + '\n' + joke.delivery);
```

A continuación, enviamos la solicitud a la API, analizamos el JSON que recibimos y componemos la respuesta.

```javascript
return callback(null, response);
```

Como último paso, completamos la ejecución de nuestra Función llamando al método `callback` y pasándole la respuesta compuesta como argumento para que sea devuelta por la Función.

El `return` no es realmente necesario, pero es una buena práctica incluirlo para dejar claro que la ejecución de la función terminará en este punto.

---

Ahora probemos nuestra Función. Puedes hacerlo simplemente abriendo la URL de tu Función en un navegador web o usando un comando como `curl` para activarla desde la línea de comandos:

```bash
$ curl https://<your_function's_url>
```

Salida esperada:

```
Why do programmers wear glasses?
Because they need to C#
```

