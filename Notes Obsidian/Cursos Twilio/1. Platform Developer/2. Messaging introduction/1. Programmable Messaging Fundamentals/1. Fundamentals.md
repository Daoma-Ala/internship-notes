## Programmable Messaging is Twilio's API for **sending and receiving SMS**

## Programmable Messaging es la API de Twilio para enviar y recibir SMS

**Programmable Messaging** es la API de Twilio para enviar y recibir mensajes de texto y multimedia. Vamos a profundizar y ver cómo se envían los mensajes de texto.

### Envío de mensajes

Para enviar un mensaje, necesitarás realizar una solicitud HTTP POST a Twilio con 3 elementos importantes:

1. **Número de origen**: el número de teléfono desde el cual se debe enviar el mensaje; este debe ser un número de teléfono de Twilio.
2. **Número de destino**: el número de teléfono que debe recibir el mensaje.
3. **Cuerpo**: el contenido del mensaje.

La siguiente animación muestra cómo se envía un mensaje.

![[Pasted image 20250128141033.png]]

El siguiente ejemplo muestra cómo enviar un mensaje utilizando [**twilio-cli**](https://www.twilio.com/docs/twilio-cli/quickstart), la herramienta de línea de comandos de Twilio.

![[Pasted image 20250128141531.png]]

¿Cómo se vería lo mismo en JavaScript?

```javascript
 1 const accountSid = 'ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX';
 2 const authToken = 'auth_token';
 3 const client = require('twilio')(accountSid, authToken);
 4 
 5 client.messages
 6      .create({
 7          body: 'Hi there!',
 8          from: '+19166190712',
 9          to: '+19166190659'
10       })
11       .then(message => console.log(message.sid))
12       .done();
```

Siéntete libre de probarlo, solo asegúrate de verificar lo siguiente:

- Tienes instalada la biblioteca [Twilio Node Helper](https://www.twilio.com/docs/libraries/node).
- Has reemplazado los marcadores de posición con tu [**Account SID** y **Auth Token**](https://support.twilio.com/hc/en-us/articles/223136027-Auth-Tokens-and-How-to-Change-Them) reales.
- Has reemplazado el número **From** con tu [número de Twilio](https://support.twilio.com/hc/en-us/articles/223135247-How-to-Search-for-and-Buy-a-Twilio-Phone-Number-from-Console).
- Has reemplazado el número **To** con un número en el que [puedas recibir mensajes](https://support.twilio.com/hc/en-us/articles/223181108-How-International-SMS-Permissions-work) SMS.

### Recepción de mensajes

Cuando tu número de Twilio recibe un nuevo mensaje entrante, Twilio enviará este mensaje a tu aplicación mediante un webhook preconfigurado. Este webhook se puede configurar a través de la [**Consola**](http://www.twilio.com/console/phone-numbers/incoming) o mediante el recurso de la API [**Incoming Phone Numbers**](http://www.twilio.com/docs/phone-numbers/api/incoming-phone-numbers).

Esta solicitud HTTP contendrá varios parámetros sobre el mensaje entrante en el formato **application/x-www-form-urlencoded**. Los parámetros más importantes serán nuevamente **To**, **From** y **Body**.

Note: You can see the full list of parameters Twilio can pass to your application on [this page](http://www.twilio.com/docs/sms/twiml#twilios-request-to-your-application)
Una vez que tu aplicación reciba la solicitud, debe reconocer la recepción del mensaje para que Twilio sepa que el mensaje ha llegado correctamente a tu aplicación. Este reconocimiento generalmente se realiza en forma de un **TwiML** `<Response>...</Response>` (enviado como **200 OK** con el tipo de contenido **text/xml**).

![[Pasted image 20250128142934.png]]

### Mensajes multimedia (MMS)

Twilio actualmente admite el envío y recepción de mensajes multimedia (MMS) en los Estados Unidos y Canadá utilizando números de teléfono compatibles con MMS.

La principal diferencia entre los mensajes de texto y los mensajes multimedia es la presencia del parámetro [**MediaUrl**](http://www.twilio.com/docs/sms/send-messages#include-media-in-your-messages). Este parámetro apunta al archivo multimedia que debe enviarse en el mensaje. Puede usarse junto con (o en lugar de) el cuerpo del mensaje.

### Ejemplo de código

```javascript
1 client.messages
2       .create({
3           body: 'Hi there!',
4           from: '+19166190712',
5           to: '+19166190659',
6           mediaUrl: 'https://demo.twilio.com/owl.png'
7        })
8       .then(message => console.log(message.sid))
9       .done();
```

El contenido multimedia puede ser una imagen, un archivo de audio o un video. Twilio maneja dos tipos de formatos de archivo:

### **Formatos admitidos**

- **image/gif**
- **image/png**
- **image/jpeg**

Estos tres formatos de archivo pueden ser re-codificados y optimizados por Twilio para garantizar la entrega al dispositivo del destinatario.

### **Tipos MIME aceptados**

Todos los demás formatos de archivo que Twilio puede aceptar. Para una lista completa, consulta la página de [tipos MIME aceptados.](http://www.twilio.com/docs/api/rest/accepted-mime-types)

### **Callbacks de estado**

Cuando envías un mensaje saliente, es posible que te interese conocer el estado de entrega de ese mensaje. Los **Status Callbacks** cumplen precisamente esa función: actualizan tu aplicación mediante un webhook proporcionado cada vez que cambia el estado del mensaje saliente.

Algunos de los estados que podrías querer rastrear son: **Accepted**, **Sent**, **Delivered**, **Undelivered**, entre otros.

Para una lista completa de posibles estados de mensajes, consulta este [artículo](http://support.twilio.com/hc/en-us/articles/223134347-What-are-the-Possible-SMS-and-MMS-Message-Statuses-and-What-do-They-Mean-)

El estado **Delivered** significa que Twilio ha recibido una confirmación de entrega de nuestro operador ascendente y, cuando esté disponible, del dispositivo de destino. Dependiendo del país o del operador de destino, el estado **Delivered** puede significar una de dos cosas:

- El mensaje fue entregado al dispositivo.
- El mensaje fue entregado al operador. Algunos operadores (generalmente en los EE. UU.) emiten la confirmación **Delivered** inmediatamente después de recibir el mensaje y comenzar a intentar entregarlo al dispositivo. En este caso, "delivered" no significa que el mensaje fue entregado al dispositivo, sino al operador (y posteriormente podría fallar la entrega al dispositivo).

### Ejemplo de código

_(nota la URL del callback de estado especificada en la línea 6):_
```javascript
1 client.messages
2       .create({
3           body: 'Hi there!',
4           from: '+19166190712',
5           to: '+19166190659',
6 statusCallback: 'http://yourdomain.com/msgStatusUpdates'
7        })
8       .then(message => console.log(message.sid))
9       .done();
```