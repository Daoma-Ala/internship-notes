# Expresiones de TaskRouter

Las expresiones de TaskRouter utilizan una notación similar a SQL que permite usar operadores de comparación para comparar claves JSON (para acceder a atributos específicos de Tareas o Trabajadores) y constantes. También se pueden usar operadores lógicos para combinar múltiples declaraciones.

## Operadores de comparación

### Operadores escalares

| Operador | Descripción |
|----------|-------------|
| `>`      | mayor que |
| `>=`     | mayor o igual que |
| `==`     | igual a |
| `!=`     | no igual a |
| `<=`     | menor o igual que |
| `<`      | menor que |
| `CONTAINS` | ¿el valor escalar de la izquierda contiene el valor escalar de la derecha? |

### Operadores de arreglos

| Operador | Descripción |
|----------|-------------|
| `HAS`    | ¿el arreglo de la izquierda contiene el valor de la derecha? |
| `IN`     | ¿el valor escalar de la izquierda existe en el arreglo de la derecha? |
| `NOT IN` | ¿el valor escalar de la izquierda NO existe en el arreglo de la derecha? |

## Operadores lógicos

| Operador | Descripción |
|----------|-------------|
| `AND`    | verdadero si ambas declaraciones (izquierda y derecha) son verdaderas |
| `OR`     | verdadero si al menos una declaración (izquierda o derecha) es verdadera |

### Ejemplos de expresiones

```plaintext
1 == 1
selected_product == "support"
support_experience > 5
task.selected_language IN worker.languages
(skills HAS 'support') AND (languages HAS 'english')
```

## ¿Dónde se usan las expresiones?

TaskRouter utiliza expresiones en múltiples contextos, a saber:

1. **Definición de Cola de Tareas (TaskQueue):** para especificar qué Trabajadores deben asociarse con una Cola de Tareas dada.
   - En este contexto, las expresiones comparan exclusivamente atributos de Trabajadores.
   - Por ejemplo: `languages HAS "en"`

2. **Filtros de Flujo de Trabajo (Workflow):** para decidir qué Tareas deben coincidir con un filtro dado.
   - En este contexto, las expresiones comparan exclusivamente atributos de Tareas.
   - Por ejemplo: `selected_language == "en"`

3. **Objetivos de Filtro de Flujo de Trabajo (Workflow Filter Targets):** para limitar opcionalmente el subconjunto de Trabajadores en una Cola de Tareas que son elegibles para una Tarea dada.
   - En este contexto, a menudo es deseable comparar directamente atributos de Tareas con atributos de Trabajadores.
   - Por lo tanto, cada atributo comparado debe tener el prefijo `worker.` o `task.` para identificar a qué objeto pertenece.
   - Por ejemplo: `worker.languages HAS task.selected_language`
   - A veces se le conoce como **Expresión Dinámica de Trabajador Objetivo**.

## Enrutamiento basado en la hora del día

TaskRouter admite el enrutamiento basado en la hora del día en expresiones utilizando las siguientes variables:

| Variable | Descripción |
|----------|-------------|
| `taskrouter.currentTime` | hora actual en formato 24hr en la zona horaria UTC, es decir, 0000-2359 |
| `taskrouter.currentMin`  | minuto actual, es decir, 00-59 |
| `taskrouter.currentHour` | hora actual en formato 24hr en la zona horaria UTC, es decir, 00-23 |
| `taskrouter.dayOfWeek`   | día actual de la semana, es decir, Mon-Sun |

- Esto significa que no tienes que implementar un enrutamiento complejo basado en la hora del día en tu código.
- Usando el enrutamiento basado en la hora del día en una expresión de Flujo de Trabajo, puedes crear fácilmente equipos fuera de horario y hacer que TaskRouter maneje automáticamente el enrutamiento basado en el tiempo.
- Puedes enrutar basado en la hora actual y el día de la semana.

### Ejemplo de expresión para decisiones de horario comercial

```plaintext
(taskrouter.dayOfWeek IN ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'] 
 AND taskrouter.currentTime > 0900 
 AND taskrouter.currentTime < 1700)
```

Este ejemplo permite tomar decisiones basadas en el horario comercial (de lunes a viernes, entre las 9:00 y las 17:00).
