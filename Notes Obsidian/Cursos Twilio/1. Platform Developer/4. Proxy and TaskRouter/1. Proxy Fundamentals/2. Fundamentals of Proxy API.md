## Twilio Proxy: API para Enmascaramiento de Conversaciones

**Twilio Proxy** es una API declarativa diseñada para simplificar la implementación de conversaciones enmascaradas entre dos partes a gran escala. Esta API incluye funciones integradas como:

- Gestión de números de teléfono
- Atribución de clientes potenciales (_Lead Attribution_)
- Reportes y análisis

### Beneficios de Proxy

1. **Implementación rápida**
    
    - Solución lista para usar con **solo unas pocas líneas de código**.
2. **Ahorro de costos**
    
    - Proxy optimiza automáticamente la cantidad de conversaciones que pueden ocurrir a través de un mismo número de Twilio, reduciendo la necesidad de adquirir múltiples números.
    - En teoría, solo se necesita **un número por sesión activa concurrente**.
    - Ejemplo: si un pasajero solo puede solicitar un viaje a la vez, tu servicio solo necesita un número de teléfono.
    - En la práctica, podrías querer usar más números para ofrecer líneas locales en cada región, pero incluso así, el costo sigue siendo bajo.
3. **Experiencia personalizada**
    
    - Las conversaciones pueden ser **limitadas en el tiempo**, **moderadas** y **grabadas**.

## Uso de la API Proxy

### Términos Clave

- **Servicio**:
    
    - Contenedor de una instancia de Proxy.
    - Administra el **pool de números de teléfono** y las configuraciones predeterminadas, como:
        - Tiempo de vida de las sesiones
        - Webhooks
        - Comportamiento de selección de números (geo-match, stickiness, etc.).
- **Sesión**:
    
    - Representa una comunicación entre **exactamente dos participantes**.
- **Participante**:
    
    - Una persona involucrada en una sesión.
- **Interacción**:
    
    - Un mensaje SMS o llamada dentro de una sesión.
    - Al listar las interacciones de una sesión, se obtiene un **registro detallado de la conversación**.

![[Pasted image 20250202153258.png]]

## Comunicación entre dos usuarios a través de Proxy

Para permitir que dos usuarios se comuniquen mediante Proxy, solo necesitas seguir estos pasos:

1. **Crear una nueva sesión** para esta interacción.
2. **Agregar a los dos usuarios como participantes** en la sesión (usando sus números de teléfono reales).
3. **Proxy asignará dos números de teléfono de Twilio** a esta sesión, uno para cada participante, basándose en:
    - Multiplexación (balanceo de carga entre números para garantizar que cada número se mantenga dentro de los límites de concurrencia de MPS).
    - Configuraciones de geo-match o stickiness.
4. Los **usuarios pueden comenzar a comunicarse** a través del número de teléfono seleccionado por Proxy.

Proxy **no asigna un solo número de teléfono del pool** para que los dos participantes lo compartan. Asigna un número para cada participante (aunque en casos raros ambos participantes podrían terminar con el mismo número).

### ¿Por qué?

No hay una razón particular para que ambos participantes interactúen a través del mismo número de teléfono. Asignar un número por participante (en lugar de uno por sesión) permite que Proxy asigne números de manera más eficiente.

### Ciclo de vida de la sesión

En cuanto al ciclo de vida de la sesión, surge la pregunta importante de **¿Cuánto tiempo debe permanecer abierta la sesión?** Hay dos parámetros que controlan esto:

- **TTL (Time To Live)**:
    - Es un tiempo relativo en segundos que especifica cuánto tiempo después de la última interacción de la sesión debe expirar.
- **Fecha de expiración**:
    - Es una fecha y hora absoluta que especifica cuándo debe expirar la sesión.
    - Si se establece la fecha de expiración, **anula** el valor de TTL.

