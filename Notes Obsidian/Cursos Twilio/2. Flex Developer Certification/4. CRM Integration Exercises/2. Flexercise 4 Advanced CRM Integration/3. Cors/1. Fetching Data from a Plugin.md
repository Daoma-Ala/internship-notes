 ahora sobre cómo podemos obtener datos del CRM desde dentro de un plugin de Flex. Esto puede ser útil si hay información adicional en el CRM que tus agentes podrían necesitar ocasionalmente, pero no tiene sentido recuperarla durante la interacción del IVR (por ejemplo, porque los datos son demasiado grandes y no tendría sentido almacenarlos en los atributos de la tarea).

A primera vista, podría parecer que simplemente consultar el CRM directamente desde el plugin debería funcionar, por ejemplo, con algo como esto:

```javascript
init(flex, manager) {
  // realizar una solicitud asíncrona al endpoint JSON de StorkCRM
  fetch('https://storkcrm-3329-dev.twil.io/json?id=543')
    .then((response) => {
      console.log(response);
    })
    .catch((error) => {
      console.error('¡Algo salió mal!', error);
    });
}
```

Sin embargo, con muchos CRMs (incluyendo nuestro StorkCRM), este intento producirá un error como este:

```
Access to fetch at 'https://storkcrm-3329-dev.twil.io/json?id=123' from origin 'http://localhost:3000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

Esto indica que la solicitud fue bloqueada por el mecanismo de **Cross-Origin Resource Sharing (CORS)**.

Ahora discutiremos por qué ocurrió esto, y en la próxima lección cubriremos cómo solucionarlo.

---

### CORS

Si no estás familiarizado con el **Cross-Origin Resource Sharing (CORS)**, conviene dar un poco de contexto. Al principio de la historia de la web, se implementó una especificación llamada **Política del Mismo Origen (Same-Origin Policy, SOP)**. Una página solo podía solicitar contenido adicional (como scripts o fuentes) desde el mismo origen, es decir, una página cargada en el navegador desde `https://flex.twilio.com` solo podía hacer solicitudes de contenido desde ese mismo protocolo-dominio-puerto.

Si una página solicitaba un script desde otro origen, este sería bloqueado.

Esto se convirtió en un problema a medida que comenzamos a compartir recursos públicos y privados entre sitios y aplicaciones web. Para manejar esto, se diseñó CORS y se añadió soporte para ello en los navegadores web.

Ahora, para que este tipo de solicitudes de recursos desde otros orígenes sean posibles (el mismo origen siempre está permitido), se deben proporcionar encabezados HTTP adicionales. De lo contrario, el acceso será bloqueado y el navegador lanzará un error.

---

### Encabezados CORS

Si el recurso debe estar disponible públicamente para un origen diferente al suyo, el servidor debe establecer el encabezado HTTP `Access-Control-Allow-Origin` en la respuesta. Su valor decidirá si:

1. Se permite cualquier origen (`*`), **O**
2. Se permite un origen específico.

Por ejemplo, si una página de `https://flex.twilio.com` solicita un recurso desde `anything.twil.io`, para que la solicitud tenga éxito, la respuesta HTTP de `anything.twil.io` debe incluir uno de estos dos encabezados:

```http
Access-Control-Allow-Origin: *
```

o

```http
Access-Control-Allow-Origin: https://flex.twilio.com
```

![[Pasted image 20250213211548.png]]
El uso del comodín `*` (que permite que cualquier origen acceda al recurso) evita en cierta medida el propósito de este mecanismo. No se recomienda en general, pero puede ser apropiado para recursos sin preocupaciones de seguridad, destinados a ser consumidos por el público en general.

Por otro lado, establecer un origen específico que pueda solicitar el recurso limitará su uso público. Este enfoque también puede combinarse con autenticación para garantizar que solo las solicitudes autorizadas desde el origen especificado sean permitidas.

Y aunque pueda parecer demasiado restrictivo permitir solo un origen específico para solicitar el recurso, un servidor web podría asignar dinámicamente el origen permitido en el encabezado de respuesta según el origen de cada solicitud en particular.

--- 

![[Pasted image 20250213211616.png]]