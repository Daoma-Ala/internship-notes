# Estructura y Funcionalidad del Plugin `CustomCRM`

## Estructura del Directorio `src/`
El directorio `src/` del plugin contiene los siguientes archivos:

- **FeathercorpFx4Plugin.js**: Archivo principal del plugin.
- **FeatherCorpTheme.js**: Tema de colores personalizado para el plugin.

### Subdirectorio `src/components/CustomCRM/`
- **Common.Styles.js**: Estilos compartidos para los componentes.
- **CustomCRM.js**: Archivo principal del componente `CustomCRM`.
- **CustomCRM.Styles.js**: Estilos específicos para el componente `CustomCRM`.
- **SecurityQuestions.jsx**: (Ignorar por ahora).
- **SecurityQuestions.Styles.js**: (Ignorar por ahora).

```bash
# src/
FeathercorpFx4Plugin.js      # main plugin file
FeatherCorpTheme.js          # plugin color theme

# src/components/CustomCRM
Common.Styles.js             # styling of shared components
CustomCRM.js                 # main CRM component file
CustomCRM.Styles.js          # styling of the CRM component
SecurityQuestions.jsx        # (ignore for now)
SecurityQuestions.Styles.js  # (ignore for now)
```
---

## Funcionalidad del Plugin

### Archivo Principal: `FeathercorpFx4Plugin.js`
El archivo principal del plugin maneja las siguientes tareas, ya cubiertas en Flexercises anteriores:
1. Cambiar el logo.
2. Aplicar un tema de colores personalizado.
3. Actualizar la información de la tarea con los detalles del cliente.

#### Cambios Relevantes:
- **Línea 36**: Se elimina el componente `CRMContainer`, ya que no se usará un iframe para StorkCRM.
- **Línea 39**: Se agrega el componente `CustomCRM`, que reemplaza al contenedor original del CRM.

```javascript
init(flex, manager) {
  // Cambiar el logo
  flex.MainHeader.defaultProps.logoUrl =
    'https://tangerine-toad-5117.twil.io/assets/feathercorp-logo-white.svg';

  // Aplicar el tema de colores
  manager.updateConfig({ colorTheme: FeatherTheme });

  // Actualizar la lista de tareas con detalles del cliente
  manager.strings.TaskHeaderLine =
    '{{task.attributes.account_data.first_name}} ' +
    '{{task.attributes.account_data.last_name}}';
  manager.strings.TaskLineCallReserved =
    'SLA: {{task.attributes.account_data.service_level}}';

  // Eliminar el contenedor del CRM
  flex.AgentDesktopView.Panel2.Content.remove('container');

  // Reemplazarlo con el nuevo componente
  flex.AgentDesktopView.Panel2.Content.add(<CustomCRM key="custom_crm" />);
}

```
---

## Componente `CustomCRM`

### Extracción de Datos del Cliente
El componente `CustomCRM` toma la información del cliente (como la dirección y la fecha de nacimiento) de los atributos de la tarea y la pre-renderiza utilizando componentes estilizados de React importados desde `Common.Styles.js`. Estos datos se almacenan en la variable `profileDetails`.

```javascript
// Construir la representación visual de los datos del perfil del cliente
let profileDetails;
if (task && task.attributes && task.attributes.account_data) {
  profileDetails = (
    <ProfileGrid>
      <div>
        <Label>Address</Label>
        <Value>
          {task.attributes.account_data.address}
          <br />
          {task.attributes.account_data.city}, 
          {task.attributes.account_data.state}, 
          {task.attributes.account_data.zip}
        </Value>
      </div>
      <div>
        <Label>Date of Birth</Label>
        <Value>{task.attributes.account_data.birthday}</Value>
      </div>
    </ProfileGrid>
  );
}
```
![[Pasted image 20250213205821.png]]
### Renderización de los Datos
Los detalles del perfil (`profileDetails`) se renderizan debajo de la foto del cliente (línea 73) y su nombre (línea 83).

```javascript
} else {
  // La tarea está seleccionada y los datos del perfil están presentes
  content = (
    <ProfileCanvas>
      <ProfilePhoto
        alt=""
        src={CRM_baseurl + task.attributes.account_data.img_src}
      />
      <HeaderLine>
        <Header>
          <Value>Customer Profile</Value>
        </Header>
      </HeaderLine>
      <LargeCaption>
        {task.attributes.account_data.first_name +
          ' ' +
          task.attributes.account_data.last_name}
      </LargeCaption>
      {profileDetails}
    </ProfileCanvas>
  );
}

return <CustomCRMContainer>{content}</CustomCRMContainer>;
```

---

### Notas Adicionales:
- El componente `ProfileGrid` se encarga de organizar la información en dos columnas.
- La foto del cliente se obtiene desde la URL base del CRM (`CRM_baseurl`) combinada con la ruta de la imagen (`img_src`).
- Este enfoque permite una visualización clara y organizada de los datos del cliente en la interfaz de Flex.


---
What is this plugin's approach to the default CRMContainer component?

--It removes the CRMContainer and replaces it with our CustomCRM component
	