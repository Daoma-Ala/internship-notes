
# Integración de DuckyCRM en CRMContainer

En esta sección, integraremos DuckyCRM en el CRMContainer, es decir, esta parte de la interfaz de Flex UI:

![[Pasted image 20250210202710.png]]

Existen dos formas de realizar actualizaciones en este contenedor:

1. **Actualizando la URI del CRMContainer** con una nueva URL que el CRM debería mostrar.
2. **Utilizando `postMessage`** para informar al CRM incrustado en el iframe que necesita actualizar su vista.

El primer método es significativamente más fácil, aunque puede no funcionar para todos los CRMs. De hecho, probablemente no funcione para la mayoría. Sin embargo, aún vale la pena echarle un vistazo, ya que ilustra bien este concepto.

El componente Flex UI `CRMContainer` tiene dos propiedades llamadas `uri` y `uriCallback`, que controlan la URL que se debe abrir dentro del iframe del CRMContainer.

- El valor de la propiedad `uri` es una URL estática.
- Por otro lado, `uriCallback` especifica, como su nombre lo indica, una función de callback que devuelve una URL para ser mostrada en el contenedor del CRM de manera dinámica, generalmente basada en el contexto de la tarea actual.

```javascript
async init(flex, manager) {

  /* ... */

  const crmUrl = 'https://duckycrm-7409-dev.twil.io';
  flex.CRMContainer.defaultProps.uriCallback = (task) => {
    if(task) {
      return `${crmUrl}/profile?id=` + task.attributes.account_number;
    } else {
      return `${crmUrl}/index`;
    }
  };
}
```

- **Línea 5**: URL base de DuckyCRM.
- **Línea 6**: Establecemos el valor de `uriCallback` a una función de callback con un parámetro: la tarea seleccionada.
- **Línea 8**: Si la tarea está definida (es decir, seleccionada en la UI), mostramos la página de perfil del CRM y le pasamos un parámetro de consulta `id` con el valor del número de cuenta que el cliente seleccionó en el IVR.
- **Línea 10**: Si no hay una tarea seleccionada, mostramos la página principal del CRM.

Intenta agregar el código anterior a tu plugin, realiza una llamada a tu Flex y deberías ver algo como esto:

![[Pasted image 20250210202915.png]]

Ahora, si intentas llamar a tu instancia de Flex, pasas por el IVR y solicitas ser conectado a un agente, deberías ver algo como esto:

![[Pasted image 20250210202935.png]]

A continuación, veamos cómo funciona `postMessage`...
