# Recuperar o reconectar partes de tu configuración de mensajería

En este módulo, discutiremos cómo puedes recuperar o reconectar partes de tu configuración de mensajería, en caso de que, por ejemplo, las modifiques o incluso las elimines por accidente.

Un gran recurso inicial para seguir al solucionar problemas de flujos de mensajería en Flex es la [FAQ: ¿Cómo soluciono problemas en mi configuración de mensajería?](enlace).

La página **Flex System Checkup** también es un buen lugar para visitar. Puede detectar ciertos problemas de configuración en tu proyecto de Flex y también es capaz de solucionar automáticamente algunos de ellos.

**Nota:** Los procedimientos descritos en este módulo son potencialmente peligrosos y pueden provocar la pérdida de datos o servicios. Si no estás seguro de alguno de los pasos detallados aquí, por favor contacta primero al soporte de Twilio.

---

## Servicio Proxy

Si terminas eliminando tu **Servicio Proxy** por accidente, ejecuta el **Flex System Checkup** para crear uno nuevo.

Después de que se cree tu nuevo Servicio Proxy, también crearemos automáticamente dos nuevos **Studio Flows** para ti: **Messaging** y **Webchat**. Si tus Studio Flows existentes funcionan bien, puedes eliminar estos nuevos.

También agregaremos automáticamente un nuevo **Flex Flow** para webchat que apunta al Studio Flow mencionado en el paso anterior. Si has eliminado el Studio Flow, siéntete libre de eliminar también el Flex Flow (una forma de identificarlo es que, si has eliminado los dos nuevos Studio Flows anteriormente, el nuevo Flex Flow se mostrará con **"Configuration Not Found"**, ya que el Studio Flow al que apuntaba ya no existe).

![[Pasted image 20250225120125.png]]

---

## Servicio de Chat

![[Pasted image 20250225120136.png]]

Si terminas eliminando tu **Servicio de Chat** por accidente, primero ejecuta el **Flex System Checkup** para crear uno nuevo.

Una vez creado, tus **Flex Flows** deberán actualizarse para apuntar al nuevo Servicio de Chat.

- Si solo tienes los dos Flex Flows predeterminados y no has realizado cambios en ellos, la forma más fácil de hacerlo es simplemente eliminarlos, y se recrearán en el siguiente paso cuando recreemos el Servicio Proxy.
- Sin embargo, si tienes algunos Flex Flows personalizados y no deseas recrearlos, simplemente actualiza su referencia al **Chat Service SID**. Esto deberá hacerse utilizando la **API REST**. Cada Flex Flow tiene un atributo `ChatServiceSid` que deberás establecer con el nuevo **Chat Service SID**. El siguiente fragmento de código muestra un ejemplo de cómo puedes hacerlo para todos tus flujos:

```bash
curl -X POST https://flex-api.twilio.com/v1/FlexFlows \
     -u "ACCOUNT_SID:AUTH_TOKEN" \
     -d "ChatServiceSid=NEW_CHAT_SERVICE_SID"
```

> **Nota:** Este fragmento de código utiliza un procesador JSON de terceros llamado `jq`, que es posible que necesites instalar por separado.

Finalmente, elimina y recrea el **Servicio Proxy** (consulta la sección anterior sobre cómo hacerlo). Si has eliminado tus Flex Flows anteriormente, esto los recreará, pero también creará dos nuevos Studio Flows (para webchat y mensajería) y apuntará los nuevos Flex Flows a ellos.

![[Pasted image 20250225120152.png]]

Si ya has personalizado tus Studio Flows existentes y deseas conservarlos, elimina los nuevos Studio Flows y luego dirígete a la configuración de **Flex Flows** para actualizarlos y que apunten a los Studio Flows antiguos (consulta la configuración predeterminada en la captura de pantalla).

Como último paso, si tienes alguna interfaz de usuario de Flex abierta, recárgala para recibir un nuevo token con permisos para tu nuevo Servicio de Chat.

---

## Espacio de trabajo de TaskRouter

Si terminas eliminando tu **Espacio de trabajo de TaskRouter** por accidente, ejecuta el **Flex System Checkup** para crear uno nuevo.

Luego, actualiza tus **Studio Flows** y sus widgets **Send to Flex** para que apunten al nuevo Espacio de trabajo.

También deberás seleccionar el canal en cada widget **Send to Flex**:
- Para los Flows de **Messaging** y **Webchat**, selecciona **"Programmable Chat"**.
- Para el Flow de **Voice IVR**, selecciona **"Voice"**.

No olvides publicar cada Flow después de realizar los cambios.

---

## Studio Flows

Para restaurar tus **Studio Flows** a los valores predeterminados, dirígete al **Studio Dashboard**. Por defecto, debería haber 3 Flows: **Voice IVR**, **Messaging IVR** y **Webchat IVR**. Cada uno de ellos debería contener un widget **Send to Flex** con la siguiente configuración predeterminada:

### Voice IVR
- **Activado por:** Llamada entrante.
- **Workflow:** Tu Workflow de TaskRouter que debe enrutar esta tarea, por defecto **"Assign to Anyone"**.
- **Canal:** Voice.
- **Atributos:**

![[Pasted image 20250225120210.png]]

### Messaging & Webchat Flows
- **Activado por:** Mensaje entrante.
- **Workflow:** Tu Workflow de TaskRouter que debe enrutar esta tarea, por defecto **"Assign to Anyone"**.
- **Canal:** Programmable Chat (esto debería ser **Programmable Chat**, incluso para el Flow de Messaging).
- **Atributos:**

![[Pasted image 20250225120220.png]]

Los atributos mencionados anteriormente son agregados automáticamente por el widget **Send to Flex** y no necesitan ser incluidos. Los incluimos en los Studio Flows creados por defecto solo para hacer explícito lo que está sucediendo.

Sin embargo, si defines estos atributos manualmente, no los sobrescribiremos. Esto puede causar problemas, por ejemplo, si estableces el `channelSid` de una tarea de mensajería en un valor arbitrario.

La interfaz de usuario de Flex depende de que este atributo contenga un **Chat Channel SID** válido, y si no es así, el agente no podrá unirse al canal de chat y comunicarse con el cliente.

No olvides publicar cada Flow después de realizar cambios.

---

## Números de teléfono

Estos pasos se pueden aplicar para agregar un nuevo número de teléfono a Flex, así como para reconectar un número existente donde parte de la configuración se haya sobrescrito por accidente.

Dirígete a la configuración del **Número de Teléfono** y establece los webhooks:

- El webhook **"A call comes in"** debe apuntar al Studio Flow llamado **"Voice IVR"**.

![[Pasted image 20250225120234.png]]

- El webhook **"A message comes in"** debe apuntar al **Servicio Proxy** llamado **"Flex Proxy Service"**.

![[Pasted image 20250225120241.png]]

Por último, asegúrate de que haya un **Flex Flow** configurado para tu número de teléfono. Si estás agregando un nuevo número de teléfono, es posible que primero necesites **Registrarlo** (ver captura de pantalla). El registro agregará el número de teléfono al Servicio Proxy y también creará un Flex Flow predeterminado para él.

![[Pasted image 20250225120255.png]]

---

Eso es todo. Esperamos que estos consejos y procedimientos de solución de problemas te hayan sido útiles para recuperarte de un problema que puedas estar enfrentando.

Y si no, por favor háznoslo saber en la encuesta al final de este curso, para cubrir otras situaciones que podamos incluir.

¡Pero primero, una rápida verificación de conocimientos!
