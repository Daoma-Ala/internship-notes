# Mensajería en Flex

## Descripción general de la arquitectura

El siguiente diagrama detalla la arquitectura de mensajería de Flex:
![[Pasted image 20250225114002.png]]

1. SMS/Canales
	Estos canales de mensajería no tienen el concepto de sesión, por lo que los mensajes se pasan primero al Proxy que mantiene el estado de la sesión.
2. Chat
	El canal de chat está diseñado teniendo en cuenta las sesiones, por lo tanto, los mensajes de chat no necesitan proxy y se pasan directamente a un chat programable.
3. Proxy
	El proxy se encarga de traducir los canales de mensajería como SMS y WhatsApp a mensajes de chat. Y luego, en la dirección opuesta, de traducir los mensajes de chat enviados desde un agente a SMS o WhatsApp.
4. Chat programable
	El chat programable mantiene un canal para cada conversación. El canal hace un seguimiento de los participantes de la conversación y almacena el historial de la misma.
	Por cierto, ¿por qué usamos el chat para todos los canales y no solo para el chat web? ¿Por qué, por ejemplo, los SMS necesitan un canal de chat?
	La razón es que, independientemente del canal que utilice el cliente, el agente siempre se comunica a través del chat desde su Flex Ul. Además, al usar el chat, obtenemos acceso a funciones como el historial del canal de chat.
5. Flujo flexible
	Flex Flow is the logic linking a messaging channel, like SMS or webchat, to Flex.
	Puede producir tres resultados:
	- Estudio: invoca el flujo de Estudio que luego puede usar el widget Enviar a Flex para crear una tarea de TaskRouter
	- Direct Task - simply creates a TaskRouter Task
	- Webhook externo: invoca la lógica del cliente que luego puede usar la API de TaskRouter para crear un nuevo Tisk
6. Estudio
	Studio se puede utilizar para crear árboles de menú de autoservicio y respondedores automáticos simples.
	El widget Enviar a Flex se puede utilizar para conectar a un cliente con un agente.
7. Webhook externo
	Proporciona una forma de invocar una aplicación externa.
	Luego, esta aplicación debe utilizar la API de TaskRouter para crear una nueva tarea y conectar al cliente con un agente.
8. Enrutador de tareas
	TaskRouter es responsable de enrutar la tarea al agente correcto.
9. Interfaz de usuario flexible
Flex Ul es la interfaz web donde el agente recibe la tarea.
---

Dos servicios de backend importantes, aunque generalmente algo ocultos, en esta arquitectura son **Proxy** y **Programmable Chat**.

Consideremos un SMS entrante que llega a tu número de Flex. Primero se envía a **Proxy**, que decide si es parte de una conversación en curso con un agente de Flex o si es el inicio de una nueva conversación.

1. **Si el mensaje es parte de una conversación en curso**, Proxy lo traducirá a un mensaje de chat y lo pasará a **Programmable Chat** para que se agregue al canal de chat existente. Luego, el mensaje se envía directamente a la interfaz de usuario de Flex para que lo vea el agente.

2. **Si el mensaje es el inicio de una nueva conversación**, Proxy creará una nueva sesión para representar esta conversación y traducirá el mensaje a un mensaje de chat. **Programmable Chat** creará un nuevo canal para rastrear a los participantes y almacenar el historial de esa conversación. Luego, dependiendo de la configuración de tu **Flex Flow**, por ejemplo, se podría invocar un flujo de **Studio** para recopilar algunos datos antes de involucrar a un agente.

---

## Flex Flows

![[Pasted image 20250225113922.png]]
Los **Flex Flows** vinculan canales de mensajería individuales, como SMS o webchat, a Flex utilizando uno de los 3 tipos de integración de Flex:

1. **Studio**
2. **Direct Task**
3. **External Webhook**

- El tipo de integración **Direct Task** crea inmediatamente una nueva tarea en **TaskRouter** y enruta el mensaje a un agente. No hay un flujo de chatbot o lógica de orquestación involucrada.

- Por otro lado, las integraciones de **Studio** y **External Webhook** generalmente implementan capacidades de chatbot o autoservicio, o ayudan a recopilar algunos datos del cliente antes de conectarlo con un agente.

Los **Flex Flows** se pueden configurar en la **Consola de Twilio** en la sección de **Flex Messaging** o utilizando la **API REST de Flex**.

---

A continuación, presentemos a **Channel Janitor**.
