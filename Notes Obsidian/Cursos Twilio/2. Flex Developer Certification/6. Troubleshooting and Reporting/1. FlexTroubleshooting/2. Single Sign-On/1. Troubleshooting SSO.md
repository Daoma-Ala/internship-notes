
# Solución de problemas de Inicio de Sesión Único (SSO)

Flex puede integrarse con un Proveedor de Identidad (IdP) existente para facilitar la autenticación de usuarios. Proporcionamos guías para integrarse con varios Proveedores de Identidad populares, aunque cualquier IdP compatible con SAML 2.0 debería ser soportado.

La integración puede presentarte varios desafíos. Discutamos un par de formas en las que puedes solucionar estos problemas.

Por ejemplo, supongamos que, al iniciar sesión a través de SSO, uno de tus usuarios enfrenta un problema. Primero, se les presenta la página de inicio de sesión del IdP, inician sesión, pero luego reciben el siguiente error:

```json
{"code": 70002, "message": "SAML response doesn't have a valid role", "more_info": "https://www.twilio.com/docs/errors/70002", "status": 400}
```

Idealmente, deberías iniciar sesión en el IdP e inspeccionar al usuario en cuestión, pero eso no siempre es posible.

Lo siguiente que puedes hacer es inspeccionar la **Respuesta SAML** que Flex recibió del IdP.

## Herramientas SAML

Este [sitio web](enlace) cataloga una colección útil de herramientas SAML para desarrolladores en varios navegadores. En este ejemplo, usaremos la extensión **SAML DevTools** para Chrome.

Instala la extensión, abre tu navegador, abre la consola de desarrollador, selecciona la pestaña **SAML** y luego intenta reproducir el problema.

![[Pasted image 20250225112330.png]]

Ahora, volviendo al error original:

**70002: La respuesta SAML no tiene un rol válido**

Para solucionar esto, inspeccionemos el atributo `roles` de la Respuesta SAML que hemos capturado usando SAML DevTools:

```xml
<saml:Attribute Name="roles">
  <saml:AttributeValue>agente</saml:AttributeValue>
</saml:Attribute>
```

Probablemente ya hayas notado el error tipográfico en el rol del agente. Los valores aceptados se describen en la página [Configuración de SSO e IdP en Flex](enlace).

En este caso, actualizar el rol a `"agent"` en el lado del IdP debería solucionar el problema.

## Almacenamiento Local

Otra herramienta de depuración a tu disposición al solucionar problemas de SSO es el **Almacenamiento Local**. Una vez que inicies sesión correctamente usando SSO, abre la consola de desarrollador, selecciona **Application**, luego **Local Storage** y `https://flex.twilio.com`, y busca "SSO".

Deberías encontrar una clave llamada `"TWILIO_FLEX_SSO"`, y en ella podrás ver los roles, la identidad y el token con los que tu usuario ha iniciado sesión.

![[Pasted image 20250225112340.png]]

- **Roles e identidad**: Te ayudan a verificar si la información que has recibido del IdP es correcta.
- **Token**: Es un token JWT encriptado que puede ser solicitado por el Soporte de Twilio y puede ayudar a identificar problemas con permisos y concesiones a varios servicios de Twilio.
