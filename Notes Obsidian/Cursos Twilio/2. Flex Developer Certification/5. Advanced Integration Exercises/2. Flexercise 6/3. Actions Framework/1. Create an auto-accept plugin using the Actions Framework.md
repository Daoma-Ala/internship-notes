
---

Se espera una afluencia de mensajes de chat a corto plazo y en gran volumen para la conferencia anual de FeatherCorp. La gerencia ha decidido probar un programa destinado a agilizar estas conversaciones. Quieren que las tareas de chat se acepten automáticamente tan pronto como se cree la reserva de la tarea para un agente. Después de la conferencia, el equipo de gestión espera que los informes muestren que esto permitió a los agentes dar la bienvenida más rápidamente al cliente y comenzar la conversación.

Para este desafío, utilizaremos el Actions Framework para apuntar al momento correcto (evento) en el que intervenir en el flujo normal de operaciones en Flex. Responderemos a ese evento "tomando acción".

Para configurar nuestro plugin y aceptar automáticamente los chats, debemos:

1. Intervenir en el evento `reservationCreated`.
2. Apuntar solo a tareas de chat.
3. Seleccionar la tarea de chat y asignarla al trabajador para esa reserva.

Para nuestra configuración inicial, solo verificaremos que podemos apuntar correctamente al evento, aislar solo las tareas de chat e identificar al trabajador actual en esa reserva. Una vez demostrado esto, podemos proceder con la funcionalidad de aceptación automática.

### Información de fondo

El canal de tareas "chat" en Flex se usa para mensajes SMS y WebChat. Además, el evento `reservationCreated` se activa cuando la tarea es reservada para el trabajador, por lo que este la ve y puede aceptarla o rechazarla (en circunstancias normales). El objeto `manager` tiene acceso a `workerClient`, que en realidad devuelve el cliente SDK de TaskRouter Worker, el cual maneja la activación de nuestro evento aquí.

Agrega lo siguiente a tu plugin, en la función `init()`:

```javascript
// Actions Framework - Plugin de aceptación automática de chats
manager.workerClient.on("reservationCreated", reservation => {
  if (reservation.task.taskChannelUniqueName === 'chat') {
    console.log("¡Esta tarea es un 'chat'!");       
    console.log("Reserva creada para el trabajador: " + reservation.workerSid);
  }
});
} // end init()
```

### ¿Cómo probar que está funcionando hasta ahora? ¿Qué deberías esperar ver?

![[Pasted image 20250224142720.png]]

- DevTools mostrando que hemos apuntado al evento y filtro de tarea deseados para el trabajador reservado.

Si pensaste: "Voy a iniciar Flex y enviar un mensaje de texto SMS al número registrado para este proyecto", ¡estás en lo correcto!  
El siguiente paso sería revisar la consola de herramientas para desarrolladores en tu navegador y verificar que el mensaje SMS fue identificado como una tarea de chat y que hay un `workerSid` mostrado para el trabajador en esta reserva.

Por ahora, el chat aún no se acepta automáticamente, pero estamos a mitad de camino. Hemos demostrado que podemos apuntar al evento correcto (`reservationCreated`), filtrar solo tareas de chat e identificar al trabajador. El siguiente paso es usar `flex.Actions.invokeAction()` para aceptar y seleccionar la tarea para ese trabajador.

(Aceptar la tarea equivale a que el trabajador haga clic en el botón de verificación con círculo verde, confirmando el chat que se le ha reservado. Seleccionar la tarea equivale a hacer clic en la tarea misma para establecerla como la tarea activa que se está visualizando y gestionando).

Reemplaza las líneas `console.log()` con las siguientes acciones:

```javascript
// Actions Framework - Plugin de aceptación automática de chats
manager.workerClient.on("reservationCreated", reservation => {
  if (reservation.task.taskChannelUniqueName === 'chat') {
    flex.Actions.invokeAction("AcceptTask", { sid: reservation.sid });
    flex.Actions.invokeAction("SelectTask", { sid: reservation.sid });       
  }
});
} // end init()
```

### Ahora las tareas de chat se aceptan automáticamente

Cuando pruebes enviar un chat nuevamente, debería aceptarse automáticamente. Podrás ver de inmediato el mensaje del cliente y actuar rápidamente para saludarlo y ayudarlo.

¡Buen trabajo! Ahora repasemos una pregunta para fijar los conceptos clave.

**Tareas de chat aceptadas automáticamente**
![[Pasted image 20250224142746.png]]

---

![[Pasted image 20250224142832.png]]
