
El **Notifications Framework** en Flex proporciona opciones para comunicarse con los usuarios de la aplicación a través de bloques de contenido de duración limitada que se muestran en pantalla. Puede combinarse con los SDK de productos de Twilio para tener aún más flexibilidad respecto a cuándo mostrarlos (en respuesta a qué eventos). Puedes revisar la documentación sobre **Notificaciones** para conocer más de una docena de notificaciones estándar, varios casos de uso, así como los métodos, propiedades y eventos disponibles.

Para esta lección, aprovecharemos el **Notifications Framework** para mostrar brevemente un **Consejo para el usuario de Flex** al iniciar la aplicación. Este tipo de repetición aleatoria puede ayudar con la incorporación, el refuerzo de habilidades o la introducción de nuevas funciones al usar el software.

### Para configurar una nueva notificación personalizada, al menos debes:

1. **Registrar la notificación**, incluyendo las propiedades clave: `id`, `type` y `content`.
2. **Despachar la notificación**.

---

### Configuración de la notificación con solo texto

Para nuestra primera versión, vamos a seleccionar aleatoriamente un **Consejo para el usuario de Flex** de un array de strings. Agrega el siguiente código al método `init()` de tu plugin, justo antes de que termine. Al registrar la notificación, hemos personalizado varias propiedades, pero usualmente querrás configurar al menos el `id`, `type` y `content`.

```javascript
// Usando Notifications Framework para una notificación personalizada
// Definir un array de consejos para usuarios de Flex
let flexTips = [
  "¿Sabías que puedes hacer una Transferencia en Frío? 1) Pulsa el botón de flecha en la parte inferior del panel de llamadas cuando estés en una llamada, 2) Selecciona la persona o cola a la que deseas transferir, 3) Pulsa la flecha del destino.",
  "¿Sabías que puedes hacer una Transferencia en Caliente? 1) Pulsa el botón de flecha en la parte inferior del panel de llamadas cuando estés en una llamada, 2) Selecciona la persona o cola a la que deseas transferir, 3) Pulsa el botón de teléfono del destino y confirma los detalles de la transferencia, 4) Pulsa la flecha para completar la transferencia.",
  "¿Sabías que después de terminar la conversación con un cliente, puedes finalizar tu trabajo relacionado antes de presionar el botón 'Complete' para marcar la transacción como terminada?",
  "¿Tienes tiempo libre entre clientes? Visita nuestra página de noticias de la empresa con el último botón en la barra de navegación."
];

// Seleccionar un consejo aleatorio
let randomTip = flexTips[Math.floor(Math.random() * flexTips.length)];

// Registrar una notificación personalizada
flex.Notifications.registerNotification({
  id: "FlexUserTip",
  type: flex.NotificationType.information,       
  backgroundColor: 'rgb(236, 237, 241)',
  timeout: 8000,
  content: randomTip      
});

// Despachar la notificación
flex.Notifications.showNotification("FlexUserTip", null);
} // end init()
```

Cuando guardes los cambios, la aplicación debería actualizarse automáticamente en tu navegador local (si no lo hace, puedes recargar la página manualmente). Deberías ver una alerta debajo del encabezado de **Flex UI**, que desaparecerá después de unos segundos. (La duración predeterminada es de **3000 ms**, pero debido a que algunos de nuestros consejos son un poco más largos, hemos aumentado el tiempo a **8 segundos**).

La notificación es bastante básica, pero ahora has proporcionado un consejo aleatorio a los usuarios al iniciar la aplicación.
![[Pasted image 20250224143143.png]]

---

### Configuración de la notificación con un componente personalizado

Notarás que en los comentarios del código marcamos la propiedad `content` de la notificación como **versión 1 (v1)**, que simplemente muestra un string. Sin embargo, podemos crear un **componente personalizado** para mejorar la estructura y el estilo. Para nuestra segunda versión, proporcionaremos un título en negrita en la primera línea de la notificación y el consejo del usuario debajo.

1. **Crea un archivo de componente para la notificación personalizada**, por ejemplo:  
    `src/components/FlexTipNotificationComponent.js`
    
2. **Importa el nuevo componente en tu plugin** y actualiza la propiedad `content` para usarlo en lugar de solo un string:
    

```javascript
// Notifications Framework - Agregar un componente de notificación personalizado
import FlexTipNotification from './components/FlexTipNotificationComponent';

async init(flex, manager) {
    ...

    // Registrar una notificación personalizada
    flex.Notifications.registerNotification({
      id: "FlexUserTip",
      type: flex.NotificationType.information,       
      backgroundColor: 'rgb(236, 237, 241)',
      timeout: 8000,

      // v1: Notificación con contenido en texto
      // content: randomTip
    
      // v2: Notificación con componente personalizado y estilos
      content: <FlexTipNotification header="Consejos de Flex" message={randomTip} />
    });

    // Despachar la notificación
    flex.Notifications.showNotification("FlexUserTip", null);
} // end init()
```
![[Pasted image 20250224143200.png]]

---

### Modificación de una notificación existente

Nuestra función de consejos agregó una nueva notificación al inicio, pero también podemos **modificar o eliminar una notificación predeterminada**.

Por ejemplo, si queremos cambiar el texto mostrado cuando una **transferencia de llamada falla**, podemos hacer lo siguiente:

```javascript
// Modificar la notificación predeterminada para el evento TransferFailed
const notification = flex.Notifications.registeredNotifications.get("TransferFailed");
notification.content = "La transferencia al agente ha fallado.";
} // end init()
```

Para probarlo:

1. **Crea otro agente** en tu espacio de trabajo en TaskRouter.
    
    - Ve a la pestaña **Workers** y agrega un nuevo trabajador.
    - Déjalo en estado **Offline**.
2. **Asegúrate de que tu usuario principal esté en estado Available**.
    
3. **Configura un número de teléfono en un Studio Flow** para poder recibir llamadas entrantes.
    
4. **Llama a ese número desde tu teléfono** y, como agente en Flex, acepta la llamada.
    
5. **Intenta transferir la llamada al agente offline**.
    

Al hacer esto, forzarás el evento **TransferFailed** y podrás verificar que el texto de la notificación se ha actualizado correctamente.

![[Pasted image 20250224143218.png]]

---

![[Pasted image 20250224143246.png]]


![[Pasted image 20250224143305.png]]

