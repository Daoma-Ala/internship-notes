**Laboratorio: Implementación de una función proxy para OwlCRM**  

En este laboratorio, vamos a implementar una función proxy para OwlCRM. Es una función muy similar a la que vimos en el Flexercise #4.  

Esta función es un poco diferente porque requiere que se proporcione un token válido con cualquier llamada desde nuestro plugin de Flex.  

Otra diferencia es que esta vez vamos a implementar el plugin utilizando la CLI de Twilio.  

Si no has instalado la CLI de Twilio y el plugin de Twilio Serverless, detente ahora y hazlo primero. Una vez hecho, marca los elementos a continuación y podrás continuar.  

---

**Preparativos**  

- **He instalado la CLI de Twilio** ([instrucciones aquí](https://www.twilio.com/docs/twilio-cli/quickstart)).  
- **También he instalado el plugin de Twilio Serverless** ([instrucciones aquí](https://www.twilio.com/docs/twilio-cli/plugins#install-serverless-plugin)).  

Ahora que tienes las herramientas necesarias, estamos casi listos para implementar nuestra función. Pero antes de usar la brillante CLI de Twilio para implementar la función, necesitamos hacer un poco de configuración.  

---

**Configuración inicial**  

1. **Archivo `.env`**:  
   Encuentra el archivo `.env.sample` en el directorio `runtime`. Su contenido se verá así:  

   ```
   ACCOUNT_SID=ACxxx
   AUTH_TOKEN=xxx
   CRM_APIKEY=passw0rd
   ```  

   Renombra el archivo a `.env` y agrega los valores de tu `ACCOUNT_SID` y `AUTH_TOKEN`.  

2. **Instalación de dependencias**:  
   Abre una terminal y navega al directorio `runtime` de tu copia local del repositorio de Git. Una vez allí, ejecuta el siguiente comando:  

   ```bash
   npm install
   ```  

   Cuando termine, tu función estará lista para ser implementada.  

---

**Implementación de la función**  

Si todavía estás en tu terminal y en el directorio `runtime`, puedes ejecutar este comando para implementar la función:  

```bash
twilio serverless:deploy
```  

Si todo va bien, deberías ver una salida similar a la siguiente:  

```
Deploying functions & assets to the Twilio Runtime

Account     AC****************************
Token       95ec****************************
Service Name    fx5-proxy-function
Environment dev
Root Directory  ~/plugin-feathercorp-fx5/runtime
Dependencies    node-fetch, twilio-flex-token-validator
Env Variables   CRM_APIKEY

✔ Serverless project successfully deployed

Deployment Details
Domain: runtime-domain-0000-dev.twil.io
Service:
   fx5-proxy-function (****************************)
Environment:
   dev (****************************)
Build SID:
   ****************************
View Live Logs:
   Open the Twilio Console
Functions:
   https://runtime-domain-0000-dev.twil.io/crm-proxy
Assets:
```  

**Nota**:  
- Toma nota de la URL de la función resaltada en el fragmento anterior. Necesitarás esa URL más adelante cuando modifiques el plugin de Flex que accede a la función.  
- También puedes observar que las dependencias y las variables de entorno se han instalado y configurado automáticamente, lo cual es muy útil.  

---

**Revisión en la consola de Twilio**  

Ahora que has terminado tu trabajo aquí, veamos qué está pasando en la consola de Twilio.  

1. **Página de resumen de servicios**:  
   Puedes encontrar tu función yendo a la página de resumen de servicios.  

![[Pasted image 20250224135225.png]]

   En esa página, verás que la primera función en la lista es tu nueva función proxy de OwlCRM. El nombre será `fx5-proxy-function`.  

2. **Editor de funciones**:  
   Si haces clic en el enlace, irás al editor de funciones.  

![[Pasted image 20250224135235.png]]

   Nota el banner en la parte superior de la página. Cuando creas una función desde la CLI de Twilio, por defecto la función no es editable desde la consola web. Si deseas cambiar ese comportamiento, revisa [esto](https://www.twilio.com/docs/runtime/functions/configuration#editing-functions).  

3. **URL de la función**:  
   Si no copiaste la URL de la función anteriormente, no es el fin del mundo. Siempre puedes obtenerla desde el editor de funciones, como se muestra a la derecha.  

---

**Resumen**  

En esta lección:  

- Vimos cómo implementar una función utilizando la CLI de Twilio.  
- Revisamos los resultados en la consola de Twilio.  

Ahora estamos listos para echar un vistazo a nuestro plugin de Flex que utiliza la función y cómo acceder al token JWT en el plugin.