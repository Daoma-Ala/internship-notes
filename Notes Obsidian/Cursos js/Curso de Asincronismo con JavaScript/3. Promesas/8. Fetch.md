# Uso de Fetch en JavaScript para peticiones HTTP as√≠ncronas

Por medio de ++Fetch++ se puede realizar peticiones HTTP as√≠ncronas de JavaScript (JS) con promesas. La API Fetch proporciona una interfaz JS m√°s c√≥moda para acceder y manipular; `fetch()` es un m√©todo global. üõ†Ô∏è 

## Instalaci√≥n de Fetch
Para poder usar `fetch`, primero tenemos que instalarlo:

1. Ir a la terminal e instalar fetch con: 
	npm i node-fetch
	
2. Para poder compilar desde VSC, debemos registrar el m√≥dulo en `package.json`. Abrimos el archivo y al final agregamos:
```json
"type": "module"
```

Importante: agregar una coma (,) a la llave que cierra a ‚Äúdependencies‚Äù.

## Creaci√≥n del archivo `challenge.js`

En la ruta `src/promise` crear el archivo `++challenge.js++`.

En el archivo `challenge.js` inicialmente se debe importar lo que acabamos de instalar, agregando el c√≥digo:

```js
import fetch from 'node-fetch';
```

Dado que la API es una constante, nunca va a cambiar, por convenci√≥n se coloca en letras may√∫sculas:

```js
const API = 'https://api.escuelajs.co/api/v1';
```

## L√≥gica con Fetch, then y catch

Ahora se crea la l√≥gica con `fetch`, `then` y `catch`:
```js
import fetch from 'node-fetch';
const API = 'https://api.escuelajs.co/api/v1';

// Funci√≥n que va a recibir como argumento la URL que queremos llamar y esto retornar√° el llamado de fetch: una promesa
function fetchData(urlApi) {
    return fetch(urlApi);
}

// El llamado
fetchData(`${API}/products`)
    .then(response => response.json())
    .then(products => {
        console.log(products);
    })
    .then(() => {
        console.log('hola');
    }) // Se pueden anidar m√∫ltiples .then
    .catch(error => console.log(error));
```

Para correrlo dentro de la consola de VSC, selecciona el c√≥digo, haz clic derecho y selecciona _Run Code_. En la salida (OUTPUT), si no arroja error, ver√°s una lista larga de elementos del llamado a la API.

## Comentarios en JavaScript

Continuando con la clase, para compilar el segundo ejemplo, debemos comentar `fetchData()` para evitar problemas de compilaci√≥n. üñäÔ∏è **¬øC√≥mo comentar en JavaScript?**

En JS se comenta cada l√≠nea con doble slash `//` o se puede comentar todo un p√°rrafo iniciando con slash + asterisco `/*` y finalizar con asterisco + slash `*/`.

Para ahorrar tiempo, se pueden usar los shortcuts de VSC, que se pueden ver y editar en `File > Preferences > Keyboard Shortcuts` o pulsando las teclas `Ctrl + K Ctrl + S`.

### Shortcuts para comentar en VSC

- Para comentar: selecciona el texto y presiona las teclas `Ctrl + K`, luego las sueltas y presionas `Ctrl + C`.
- Para quitar los comentarios: selecciona el texto comentado, presiona `Ctrl + K`, luego las sueltas y presionas `Ctrl + U`.

## Segundo ejemplo

El c√≥digo del segundo ejemplo queda as√≠:
```js
fetchData(`${API}/products`)
    .then(response => response.json()) // Se hace la conversi√≥n a un objeto JSON
    .then(products => {
        console.log(products);
        return fetchData(`${API}/products/${products[0].id}`); // Solo se quiere mostrar el primer elemento de la primera solicitud
    })
    .then(response => response.json()) // Se vuelve a traer la data
    .then(product => {
        console.log(product.title);
        return fetchData(`${API}/categories/${product.category.id}`); // Se quiere mostrar la categor√≠a de un producto en particular
    })
    .then(response => response.json())
    .then(category => {
        console.log(category.name);
    })
    .catch(err => console.log(err)) // Detectar un error
    .finally(() => console.log('Finally')); // Es opcional para mostrar que se termin√≥ la solicitud
```

Al correrlo con _Run Code_, la salida muestra una lista larga con la √∫ltima palabra impresa: `Finally`.

